"use strict";(self.webpackChunkhtml=self.webpackChunkhtml||[]).push([[966],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>k});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(t),d=a,k=m["".concat(l,".").concat(d)]||m[d]||u[d]||s;return t?r.createElement(k,o(o({ref:n},p),{},{components:t})):r.createElement(k,o({ref:n},p))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[m]="string"==typeof e?e:a,o[1]=i;for(var c=2;c<s;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8969:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=t(7462),a=(t(7294),t(3905));const s={sidebar_position:2},o="T\u1ea1o server \u0111\u01a1n gi\u1ea3n b\u1eb1ng Express + Prisma v\xe0 tri\u1ec3n khai b\u1eb1ng Docker",i={unversionedId:"express-prisma-dockerize",id:"express-prisma-dockerize",title:"T\u1ea1o server \u0111\u01a1n gi\u1ea3n b\u1eb1ng Express + Prisma v\xe0 tri\u1ec3n khai b\u1eb1ng Docker",description:"C\u1ea5u tr\xfac c\xe2y th\u01b0 m\u1ee5c",source:"@site/docs/express-prisma-dockerize.md",sourceDirName:".",slug:"/express-prisma-dockerize",permalink:"/my-blog/express-prisma-dockerize",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"T\xf9y ch\u1ec9nh m\xe0u s\u1eafc ch\u1ebf \u0111\u1ed9 light, dark mode trong Material UI",permalink:"/my-blog/"},next:{title:"Drap and Drop files trong React",permalink:"/my-blog/category/drap-and-drop-files-trong-react"}},l={},c=[{value:"C\u1ea5u tr\xfac c\xe2y th\u01b0 m\u1ee5c",id:"c\u1ea5u-tr\xfac-c\xe2y-th\u01b0-m\u1ee5c",level:2},{value:"C\xe0i \u0111\u1eb7t c\xe1c th\u01b0 vi\u1ec7n c\u1ea7n thi\u1ebft",id:"c\xe0i-\u0111\u1eb7t-c\xe1c-th\u01b0-vi\u1ec7n-c\u1ea7n-thi\u1ebft",level:2},{value:"Kh\u1edfi t\u1ea1o c\u1ea5u h\xecnh TypeScript",id:"kh\u1edfi-t\u1ea1o-c\u1ea5u-h\xecnh-typescript",level:2},{value:"Kh\u1edfi t\u1ea1o Prisma",id:"kh\u1edfi-t\u1ea1o-prisma",level:2},{value:"Code",id:"code",level:2},{value:"Ch\u1ea1y \u1edf m\xf4i tr\u01b0\u1eddng ph\xe1t tri\u1ec3n",id:"ch\u1ea1y-\u1edf-m\xf4i-tr\u01b0\u1eddng-ph\xe1t-tri\u1ec3n",level:2},{value:"Tri\u1ec3n khai Docker",id:"tri\u1ec3n-khai-docker",level:2}],p={toc:c},m="wrapper";function u(e){let{components:n,...s}=e;return(0,a.kt)(m,(0,r.Z)({},p,s,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"t\u1ea1o-server-\u0111\u01a1n-gi\u1ea3n-b\u1eb1ng-express--prisma-v\xe0-tri\u1ec3n-khai-b\u1eb1ng-docker"},"T\u1ea1o server \u0111\u01a1n gi\u1ea3n b\u1eb1ng Express + Prisma v\xe0 tri\u1ec3n khai b\u1eb1ng Docker"),(0,a.kt)("h2",{id:"c\u1ea5u-tr\xfac-c\xe2y-th\u01b0-m\u1ee5c"},"C\u1ea5u tr\xfac c\xe2y th\u01b0 m\u1ee5c"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1697644554621",src:t(7695).Z,width:"349",height:"798"})),(0,a.kt)("h2",{id:"c\xe0i-\u0111\u1eb7t-c\xe1c-th\u01b0-vi\u1ec7n-c\u1ea7n-thi\u1ebft"},"C\xe0i \u0111\u1eb7t c\xe1c th\u01b0 vi\u1ec7n c\u1ea7n thi\u1ebft"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"C\xe0i \u0111\u1eb7t c\xe1c dependencies:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install express dotenv cors cookie-parser @types/node tslib @prisma/client\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"C\xe0i \u0111\u1eb7t c\xe1c devDependencies:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -D typescript tsc-alias nodemon esno @types/express @types/cors @types/cookie-parser\n")),(0,a.kt)("h2",{id:"kh\u1edfi-t\u1ea1o-c\u1ea5u-h\xecnh-typescript"},"Kh\u1edfi t\u1ea1o c\u1ea5u h\xecnh TypeScript"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npx tsc --init\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="tsconfig.json"',title:'"tsconfig.json"'},'{\n  "compilerOptions": {\n    "strict": true,\n    "target": "ESNext",\n    "module": "CommonJS",\n    "outDir": "build",\n    "moduleResolution": "Node",\n    "resolveJsonModule": true,\n    "importHelpers": true,\n    "skipLibCheck": true,\n    "removeComments": true,\n    "allowSyntheticDefaultImports": true,\n    "esModuleInterop": true,\n    "noUncheckedIndexedAccess": true,\n    "forceConsistentCasingInFileNames": true,\n    "experimentalDecorators": true,\n    "baseUrl": ".",\n    "paths": {\n      "src/*": ["./src/*"]\n    }\n  },\n  "include": ["src"],\n  "exclude": ["node_modules"]\n}\n')),(0,a.kt)("h2",{id:"kh\u1edfi-t\u1ea1o-prisma"},"Kh\u1edfi t\u1ea1o Prisma"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u0110\u1ec3 kh\u1edfi t\u1ea1o Prisma, ta g\xf5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npx prisma init\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-prisma",metastring:'title="back-end/prisma/schema.prisma"',title:'"back-end/prisma/schema.prisma"'},'generator client {\n  provider = "prisma-client-js"\n}\n\ndatasource db {\n  provider = "mysql"\n  url      = env("DATABASE_URL")\n}\n\nmodel User {\n  id        String   @id @default(uuid())\n  name      String\n  email     String\n  password  String\n  createdAt DateTime @default(now())\n  updatedAt DateTime @default(now())\n\n  @@map("user")\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u0110\u1ec3 t\u1ea1o c\xe1c table trong database \u1ee9ng v\u1edbi c\xe1c model ta \u0111\xe3 khai b\xe1o trong Prisma, g\xf5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npx prisma migrate dev\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u0110\u1ec3 map c\xe1c model \u0111\xe3 khai b\xe1o trong Prisma v\xe0o Prisma client, g\xf5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npx prisma generate\n")),(0,a.kt)("h2",{id:"code"},"Code"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"C\u1ea5u h\xecnh \u0111\u1ec3 s\u1eed d\u1ee5ng bi\u1ebfn m\xf4i tr\u01b0\u1eddng trong file ",(0,a.kt)("strong",{parentName:"li"},".env"),":")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="back-end/src/configs/env-config.ts"',title:'"back-end/src/configs/env-config.ts"'},'import dotenv from "dotenv";\n\ndotenv.config();\n\nconst env = {\n  PORT: process.env.PORT,\n};\n\nexport default env;\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o type cho User:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="back-end/src/types/user-types.ts"',title:'"back-end/src/types/user-types.ts"'},"export type TUser = {\n  name: string;\n  email: string;\n  password: string;\n};\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o h\xe0m controller:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="back-end/src/controllers/user-controller.ts"',title:'"back-end/src/controllers/user-controller.ts"'},'import { Response, Request } from "express";\nimport { PrismaClient } from "@prisma/client";\n\nimport { TUser } from "src/types/user-types";\n\nconst prisma = new PrismaClient();\n\nconst userController = {\n  getAllUsers: async (req: Request, res: Response) => {\n    try {\n      const users = await prisma.user.findMany();\n      res.status(200).json(users);\n    } catch (error) {\n      res.status(500).json(error);\n    }\n  },\n\n  addUser: async (req: Request, res: Response) => {\n    try {\n      const { name, email, password } = req.body as TUser;\n      const user = await prisma.user.create({\n        data: {\n          name,\n          email,\n          password,\n        },\n      });\n      res.status(200).json(user);\n    } catch (error) {\n      res.status(500).json(error);\n    }\n  },\n};\n\nexport default userController;\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o route:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="back-end/src/routes/user-route.ts"',title:'"back-end/src/routes/user-route.ts"'},'import { Router } from "express";\nimport userController from "src/controllers/user-controller";\n\nconst userRoute = Router();\n\nuserRoute.get("/", userController.getAllUsers);\nuserRoute.post("/create", userController.addUser);\n\nexport default userRoute;\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"H\xe0m ch\xednh:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="back-end/src/main.ts"',title:'"back-end/src/main.ts"'},'import express, { Application } from "express";\nimport cors from "cors";\nimport cookieParser from "cookie-parser";\nimport userRoute from "./routes/user-route";\nimport env from "./configs/env-config";\n\nconst app: Application = express();\n\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(cookieParser());\n\napp.use("/api/v1/user", userRoute);\n\napp.listen(env.PORT, () => {\n  console.log(`Server is running on port ${env.PORT}`);\n});\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Th\xeam bi\u1ebfn m\xf4i tr\u01b0\u1eddng v\xe0o file ",(0,a.kt)("strong",{parentName:"li"},".env"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-.env",metastring:'title="back-end/.env"',title:'"back-end/.env"'},'PORT=8080\nDATABASE_URL="mysql://root:ptit_62699502@localhost:3306/antsadatabase"\n')),(0,a.kt)("h2",{id:"ch\u1ea1y-\u1edf-m\xf4i-tr\u01b0\u1eddng-ph\xe1t-tri\u1ec3n"},"Ch\u1ea1y \u1edf m\xf4i tr\u01b0\u1eddng ph\xe1t tri\u1ec3n"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"V\xe0o file ",(0,a.kt)("strong",{parentName:"li"},"package.json")," \u0111\u1ec3 c\u1ea5u h\xecnh l\u1ec7nh ch\u1ea1y:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  "name": "typescript-project",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "scripts": {\n    "dev": "nodemon --exec esno src/main.ts",\n    "build": "tsc && tsc-alias",\n    "start": "npx prisma migrate deploy && node build/main.js"\n  },\n  "keywords": [],\n  "author": "",\n  "license": "ISC",\n  "devDependencies": {\n    "@types/cookie-parser": "^1.4.4",\n    "@types/cors": "^2.8.14",\n    "@types/express": "^4.17.19",\n    "esno": "^0.17.0",\n    "nodemon": "^3.0.1",\n    "tsc-alias": "^1.8.8",\n    "typescript": "^5.2.2"\n  },\n  "dependencies": {\n    "@prisma/client": "^5.4.2",\n    "@types/node": "^20.8.0",\n    "cookie-parser": "^1.4.6",\n    "cors": "^2.8.5",\n    "dotenv": "^16.3.1",\n    "express": "^4.18.2",\n    "tslib": "^2.6.2"\n  }\n}\n')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"G\xf5 ",(0,a.kt)("inlineCode",{parentName:"li"},"npm run dev")," \u0111\u1ec3 ch\u1ea1y \u1ee9ng d\u1ee5ng server \u1edf m\xf4i tr\u01b0\u1eddng ph\xe1t tri\u1ec3n"))),(0,a.kt)("h2",{id:"tri\u1ec3n-khai-docker"},"Tri\u1ec3n khai Docker"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o ",(0,a.kt)("strong",{parentName:"li"},"Dockerfile"),":")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-Dockerfile",metastring:'title="back-end/Dockerfile"',title:'"back-end/Dockerfile"'},'FROM node:18-alpine AS build\nWORKDIR /usr/src/app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nRUN npm run build\n\nFROM node:18-alpine\nWORKDIR /usr/src/app\nCOPY --from=build /usr/src/app/build ./build\nCOPY --from=build /usr/src/app/prisma ./prisma\nCOPY --from=build /usr/src/app/package*.json ./\nRUN npm install --omit=dev\n\nCMD [ "npm", "start" ]\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o file ",(0,a.kt)("strong",{parentName:"li"},".dockerignore")," \u0111\u1ec3 ch\u1ec9 \u0111\u1ecbnh file, th\u01b0 m\u1ee5c m\xe0 Docker s\u1ebd kh\xf4ng kh\xf4ng copy n\xf3:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-.ignore",metastring:'title="back-end/.dockerignore"',title:'"back-end/.dockerignore"'},"node_modules\nbuild\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o file ",(0,a.kt)("strong",{parentName:"li"},"docker-compose.yaml")," \u0111\u1ec3 ch\u1ea1y 2 container database v\xe0 backend:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="docker-compose.yaml"',title:'"docker-compose.yaml"'},'version: "3.8"\n\nservices:\n  backend:\n    depends_on:\n      - mysqldb\n    container_name: antsa-backend\n    restart: always\n    build:\n      context: ./back-end\n    env_file:\n      - ./env/backend.env\n    ports:\n      - 8080:8080\n    networks:\n      - antsa_network\n\n  mysqldb:\n    image: mysql:latest\n    container_name: antsa-database\n    restart: always\n    env_file:\n      - ./env/database.env\n    ports:\n      - 3306:3306\n    volumes:\n      - ./database/backup:/var/lib/mysql\n    networks:\n      - antsa_network\n\nnetworks:\n  antsa_network:\n    driver: bridge\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"T\u1ea1o 2 file bi\u1ebfn m\xf4i tr\u01b0\u1eddng trong th\u01b0 m\u1ee5c ",(0,a.kt)("strong",{parentName:"li"},"env")," \u0111\u1ec3 s\u1eed d\u1ee5ng trong docker-compose:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-env",metastring:'title="backend.env"',title:'"backend.env"'},"PORT=8080\nDATABASE_URL=mysql://root:ptit_15092002@mysqldb:3306/antsadatabase\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-env",metastring:'title="database.env"',title:'"database.env"'},"MYSQL_DATABASE=antsadatabase\nMYSQL_ROOT_PASSWORD=ptit_15092002\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Th\u01b0 m\u1ee5c ",(0,a.kt)("strong",{parentName:"li"},"database")," \u0111\u1ec3 l\u01b0u tr\u1eef d\u1eef li\u1ec7u trong database, \u0111\u1ea3m b\u1ea3o khi kh\u1edfi \u0111\u1ed9ng l\u1ea1i container th\xec d\u1eef li\u1ec7u \u0111\xe3 l\u01b0u trong CSDL s\u1ebd kh\xf4ng b\u1ecb m\u1ea5t."))),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"\u0110\u1ec3 kh\u1edfi \u0111\u1ed9ng \u1ee9ng d\u1ee5ng docker compose, g\xf5:")),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose up --build -d\n")),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"B\xe2y gi\u1edd, \u1ee9ng d\u1ee5ng c\u1ee7a ta \u0111ang ch\u1ea1y tr\xean ",(0,a.kt)("strong",{parentName:"li"},"http://localhost:8080/")),(0,a.kt)("li",{parentName:"ul"},"\u0110\u1ec3 t\u1eaft docker compose v\xe0 x\xf3a c\xe1c container, g\xf5:")),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose down\n"))))}u.isMDXComponent=!0},7695:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/1697644554621-4b65999dea1cd4020982399e79cab91e.png"}}]);